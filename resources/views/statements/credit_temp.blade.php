<div id="print-content" style="display: none">
    <h4 class="text-center">
        Ведомость учета успеваемости студентов № 315434
    </h4>
    <div class="row">
        <div class="col-md-12" style="font-size: 0.8em">
            <div class="row">
                <div class="col-md-3">
                    <span>Преподаватель: <span>Мышов А.С.</span></span>
                </div>
                <div class="col-md-3">
                    <span>Курс: <span>4</span></span>

                </div>
                <div class="col-md-6">
                    <span>Дисциплина: <span>Компьютерные сети и телекоммуникации</span></span>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <span>Кафедра: <span>СКС</span></span>
                </div>
                <div class="col-md-3">
                    <span>Семестр: <span>7</span></span>

                </div>
                <div class="col-md-6">
                    <span>Количество часов: <span>72</span></span>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <span>Группа: <span>СКС-17</span></span>

                </div>
                <div class="col-md-3">
                    <span>Учебный год: <span>2020-2021</span></span>
                </div>
                <div class="col-md-6">
                    <span>Статус: <span><b>Закрыта</b></span></span>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-1">
        <h5>Зачет</h5>
    </div>

    <div class="row">
        <div class="col-md-12">
            <table border="1" style="text-align: center; font-size: 0.9em">
                <thead>
                    <tr>
                        <th rowspan="2">№</th>
                        <th rowspan="2">Ф.И.О.</th>
                        <th rowspan="2">Зачетная книжка</th>
                        <th colspan="5">Точка 1 22.02.2022</th>
                        <th colspan="5">Точка 1 22.02.2022</th>
                        <th rowspan="2">Надбавка</th>
                        <th rowspan="2">Оценка в процентах</th>
                        <th rowspan="2">Оценка по рейтингу </th>
                        <th rowspan="2">Дата</th>
                        <th rowspan="2">Подпись</th>
                    </tr>
                    <tr>
                        <th>Лек.</th>
                        <th>Пр.</th>
                        <th>Лаб.</th>
                        <th>Проп.</th>
                        <th>Итог</th>
                        <th>Лек.</th>
                        <th>Пр.</th>
                        <th>Лаб.</th>
                        <th>Проп.</th>
                        <th>Итог</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Мышов А.С.</td>
                        <td>123123</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td>65</td>
                        <td>55</td>
                        <td>70</td>
                        <td></td>
                        <td>60</td>
                        <td></td>
                        <td>60</td>
                        <td>удовл</td>
                        <td>20.03.2022</td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>


<script type="text/javascript">
    $('#toolbar').w2toolbar({
        name: 'toolbar',
        items: [
            { type: 'button', id: 'refresh', text: 'Обновить', icon: 'fas fa-redo' },
            { type: 'button', id: 'save', text: 'Сохранить', icon: 'fas fa-save' },
            { type: 'button', id: 'print', text: 'Печать', icon: 'fas fa-print' },
            { type: 'break' },
            { type: 'radio', id: 'unlock', group: '1', text: 'Открыть', icon: 'fas fa-lock-open', checked: true },
            { type: 'radio', id: 'lock', group: '1', text: 'Закрыть', icon: 'fas fa-lock' },
        ],
        onClick: function (event) {
            switch(event.target){
                case('print'):
                    this.print();
                    break;
            }
            // console.log('Target: '+ event.target, event);
        },
        print: function(){
            let windowPrint = window.open('http://' + location.host + '/pr.html');

            windowPrint.onload = function() {
                var doc = windowPrint.document;

                var newDiv = doc.createElement("div");
                document.getElementById('print-content').style.display = 'block'
                newDiv.innerHTML = document.getElementById('print-content').innerHTML;
                doc.body.appendChild(newDiv);
            };

            windowPrint.print();

            windowPrint.onafterprint = function(event) {
                windowPrint.close();
                document.getElementById('print-content').style.display = 'none';
            }
        }
    });

    var data = [
        {
            recid: 1,
            user_id: 1,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 60,
            total: 'Удовл'
        },
        {
            recid: 2,
            user_id: 2,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 78,
            total: 'Удовл'
        },
        {
            recid: 3,
            user_id: 3,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 88,
            total: 'Удовл'
        },
        {
            recid: 4,
            user_id: 4,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 95,
            total: 'Удовл'
        },
        {
            recid: 5,
            user_id: 5,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 65,
            total: 'Удовл'
        },
        {
            recid: 6,
            user_id: 6,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 76,
            total: 'Удовл'
        },
        {
            recid: 7,
            user_id: 7,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 71,
            total: 'Удовл'
        },
        {
            recid: 8,
            user_id: 8,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 68,
            total: 'Удовл'
        },
        {
            recid: 9,
            user_id: 9,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 88,
            total: 'Удовл'
        },
        {
            recid: 10,
            user_id: 10,
            full_name: 'Мышов А.С.',
            record_book_number: '321435',
            first_checkout_lecture_percent: 65,
            first_checkout_practice_percent: 55,
            first_checkout_lab_percent: 70,
            first_checkout_passes: null,
            first_checkout_total_percent: 60,
            second_checkout_lecture_percent: 65,
            second_checkout_practice_percent: 55,
            second_checkout_lab_percent: 70,
            second_checkout_passes: null,
            second_checkout_total_percent: 60,
            increment_percent: null,
            total_percent: 91,
            total: 'Удовл'
        },
        {
                    recid: 11,
                    user_id: 11,
                    full_name: 'Мышов А.С.',
                    record_book_number: '321435',
                    first_checkout_lecture_percent: 65,
                    first_checkout_practice_percent: 55,
                    first_checkout_lab_percent: 70,
                    first_checkout_passes: null,
                    first_checkout_total_percent: 60,
                    second_checkout_lecture_percent: 65,
                    second_checkout_practice_percent: 55,
                    second_checkout_lab_percent: 70,
                    second_checkout_passes: null,
                    second_checkout_total_percent: 60,
                    increment_percent: null,
                    total_percent: 78,
                    total: 'Удовл'
                },

        { w2ui: { summary: false },
            recid: 'S-1',
            full_name: 'Итого:'
        },
    ];

    $(function () {
        $('#grid').w2grid({
            name: 'grid',
            columnGroups: [
                { text: '', span: 1 },
                { text: '', span: 1 },
                { text: '', span: 1 },
                { text: 'Точка 1 22.02.2022', span: 5 },
                { text: 'Точка 2 22.02.2022', span: 5 },
                { text: '', span: 1 },
                { text: 'Итоговый процент', span: 4 },
                { text: '', span: 1 },
                { text: '', span: 1 },
                { text: '', span: 1 }
            ],
            columns: [
                { field: 'user_id', text: '№', size: '30px', resizable: true , style: 'border: 1px solid #d2d1d1;', render: function (record, extra) {
                    console.log('123', record, extra);
            return extra.value || '';
        } },
                { field: 'full_name', text: 'Ф.И.О.', size: '150px', sortable: true, style: 'border: 1px solid #d2d1d1;', resizable: true},
                { field: 'record_book_number', text: 'Зачетная книжка', size: '120px', style: 'border: 1px solid #d2d1d1;', resizable: true, attr: "align=center"},

                { field: 'first_checkout_lecture_percent', text: 'Лек.', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;', editable: { type: 'int', min: 60, max: 100 }},
                { field: 'first_checkout_practice_percent', text: 'Пр.', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;', editable: { type: 'int', min: 60, max: 100 }},
                { field: 'first_checkout_lab_percent', text: 'Лаб.', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;', editable: { type: 'int', min: 60, max: 100 }},
                { field: 'first_checkout_passes', text: 'Пропуск', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;'},
                { field: 'first_checkout_total_percent', text: 'Итог', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;', editable: { type: 'int', min: 60, max: 100 }},

                { field: 'second_checkout_lecture_percent', text: 'Лек.', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;', editable: { type: 'int', min: 60, max: 100 }},
                { field: 'second_checkout_practice_percent', text: 'Пр.', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;', editable: { type: 'int', min: 60, max: 100 }},
                { field: 'second_checkout_lab_percent', text: 'Лаб.', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;', editable: { type: 'int', min: 60, max: 100 }},
                { field: 'second_checkout_passes', text: 'Пропуск.', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;',},
                { field: 'second_checkout_total_percent', text: 'Итог.', size: '60px', attr: 'align=center', style: 'background: #efe; border: 1px solid #d2d1d1;', editable: { type: 'int', min: 60, max: 100 }},

                { field: 'increment_percent', text: 'Надбавка', size: '50px', style: 'border: 1px solid #d2d1d1;', attr: 'align=center'},


                { field: 'user_not_satisfactorily_percent', text: 'неуд', size: '50px', style: 'border: 1px solid #d2d1d1;', attr: 'align=center',
                    render: function(record, extra){
                        if(record.recid !== 'S-1')
                            return record.total_percent < 60 ? record.total_percent : null;
                        else{
                            let count = 0;
                            data.forEach(function (item) {
                                item.total_percent < 60 ? count++ : null;
                            });
                            return count;
                        }
                    }
                },
                { field: 'user_satisfactorily_percent', text: 'удл', size: '50px', style: 'border: 1px solid #d2d1d1;', attr: 'align=center',
                    render: function(record, extra){
                        if(record.recid !== 'S-1')
                            return record.total_percent >= 60 && record.total_percent <= 73 ? record.total_percent : null;
                        else{
                            let count = 0;
                            data.forEach(function (item) {
                                item.total_percent >= 60 && item.total_percent <= 73 ? count++ : null;
                            });
                            return count;
                        }
                    }
                },
                { field: 'user_good_percent', text: 'хор', size: '50px', style: 'border: 1px solid #d2d1d1;', attr: 'align=center',
                    render: function(record, extra){
                        if(record.recid !== 'S-1')
                            return record.total_percent >= 74 && record.total_percent <= 89 ? record.total_percent : null;
                        else{
                            let count = 0;
                            data.forEach(function (item) {
                                item.total_percent >= 74 && item.total_percent <= 89 ? count++ : null;
                            });
                            return count;
                        }
                    }
                },
                { field: 'user_great_percent', text: 'отл', size: '50px', style: 'border: 1px solid #d2d1d1;', attr: 'align=center',
                    render: function(record, extra){
                        if(record.recid !== 'S-1')
                            return record.total_percent >= 90 && record.total_percent <= 100 ? record.total_percent : null;
                        else{
                            let count = 0;
                            data.forEach(function (item) {
                                item.total_percent >= 90 && item.total_percent <= 100 ? count++ : null;
                            });
                            return count;
                        }
                    }
                },

                { field: 'total_percent', text: 'Оценка в процентах', size: '50px', style: 'border: 1px solid #d2d1d1;', attr: 'align=center', editable: { type: 'int', min: 60, max: 100 }},
                { field: 'total', text: 'Оценка по рейтингу', size: '50px', style: 'border: 1px solid #d2d1d1;', attr: 'align=center'},
                { field: 'is_credit', text: 'Итог', size: '50px', style: 'border: 1px solid #d2d1d1;', attr: 'align=center'},
            ],
            toolbar: {
                // items: [
                //     { id: 'add', type: 'button', text: 'Add Record', icon: 'w2ui-icon-plus' },
                //     { id: 'test', type: 'button', text: 'Add Record', icon: 'w2ui-icon-plus' }
                // ],
                // onClick: function (event) {
                //     if (event.target == 'add') {
                //         w2ui.grid.add({ recid: w2ui.grid.records.length + 1 });
                //     }
                //     if (event.target == 'test') {
                //         console.log('123');
                //     }
                // }
            },
            records: data,
            onChange: function(event) {
                console.log(event.column, event.index, event.value_new, event.value_original);
            }
        });
    });

    function showChanged() {
        w2popup.open({
            title: 'Records Changes',
            with: 600,
            height: 550,
            body: `<pre>${JSON.stringify(w2ui['grid'].getChanges(), null, 4)}</pre>`,
            buttons: '<button class="w2ui-btn" onclick="w2popup.close()">Ok</button>'
        })
    }
</script>
